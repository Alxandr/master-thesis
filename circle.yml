dependencies:
  cache_directories:
    - "~/.apt-cache"
    - "~/.linuxbrew"
  pre:
    - sudo rm -rf /var/cache/apt/archives && sudo ln -s ~/.apt-cache /var/cache/apt/archives && mkdir -p ~/.apt-cache/partial
    - echo "" | ruby -e "$(curl -fsSL https://raw.githubusercontent.com/Linuxbrew/install/master/install)"
    - brew install haskell-stack pandoc pandoc-citeproc
    - |
      pushd $HOME/deps/pandoc-mermaid
      stack --no-terminal --install-ghc test --bench --only-dependencies
      stack --no-terminal install --bench --no-run-benchmarks --haddock --no-haddock-deps
      popd
    - sudo apt-get update; sudo apt-get install texlive-full inkscape

checkout:
  pre:
    - echo $PATH
  post:
    - mkdir -p $HOME/deps
    - git clone https://github.com/Alxandr/pandoc-mermaid.git $HOME/deps/pandoc-mermaid

compile:
  override:
    - make
    - cp report.pdf $CIRCLE_ARTIFACTS

machine:
  pre:
    - sudo curl --output /usr/local/bin/phantomjs https://s3.amazonaws.com/circle-downloads/phantomjs-2.1.1
  node:
    version: node
  ruby:
    version:
      2.4.0
  environment:
    PATH: "$HOME/.linuxbrew/bin:$PATH"